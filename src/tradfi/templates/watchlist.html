{% extends "base.html" %}
{% from "components/signal_badge.html" import signal_badge %}
{% block title %}Watchlist — Red Queen{% endblock %}
{% block content %}
<div class="watchlist-page">
  <h1 class="font-brand">Watchlist</h1>

  {% if items %}
  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>Ticker</th><th>Company</th><th>Price</th>
          <th>P/E</th><th>RSI</th><th>MoS%</th><th>Signal</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="watchlist-tbody">
        {% for item in items %}
        {% set stock = stocks.get(item.ticker) %}
        <tr id="watchlist-row-{{ item.ticker }}">
          <td class="col-ticker"><a href="/stock/{{ item.ticker }}">{{ item.ticker }}</a></td>
          <td class="col-company truncate">{{ stock.name if stock else "-" }}</td>
          <td class="col-price font-mono">{{ stock.current_price | fmt_price if stock else "-" }}</td>
          {% if stock %}
          <td class="font-mono {{ stock.valuation.pe_trailing | metric_class(METRIC_THRESHOLDS.pe_trailing) }}">{{ stock.valuation.pe_trailing | fmt_ratio }}</td>
          <td class="font-mono {{ stock.technical.rsi_14 | metric_class(METRIC_THRESHOLDS.rsi_14) }}">{% if stock.technical.rsi_14 is not none %}{{ "%.0f" | format(stock.technical.rsi_14) }}{% else %}-{% endif %}</td>
          <td class="font-mono {{ stock.fair_value.margin_of_safety_pct | metric_class(METRIC_THRESHOLDS.margin_of_safety_pct) }}">{{ stock.fair_value.margin_of_safety_pct | fmt_signed_pct }}</td>
          <td>{{ signal_badge(stock.signal) }}</td>
          {% else %}
          <td colspan="4" class="metric--dim">Not cached</td>
          {% endif %}
          <td>
            <button class="btn-icon" title="Remove"
                    hx-delete="/api/v1/watchlist/{{ item.ticker }}"
                    hx-target="#watchlist-row-{{ item.ticker }}"
                    hx-swap="outerHTML swap:200ms">
              ✕
            </button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="empty-state">
    <p>Your watchlist is empty.</p>
    <p class="text-muted">Add stocks from the screener or stock detail pages.</p>
  </div>
  {% endif %}
</div>
{% endblock %}
